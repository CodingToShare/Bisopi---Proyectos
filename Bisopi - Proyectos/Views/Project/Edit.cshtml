<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" />

@model Bisopi___Proyectos.Models.Project

<h4>Editar Proyecto</h4>
<hr />
<br />

<div class="row">
    <div class="col-12">
        <span class="float-right">
            <a class="btn btn-dark" href="/Project/Index">Volver</a>
        </span>
    </div>
    <div class="col-12">
        <form asp-controller="Project" asp-action="Edit" method="post" enctype="multipart/form-data">
            @Html.HiddenFor(x => x.ProjectID, new { @class = "ProjectID" })
            @Html.HiddenFor(x => x.Created, new { @class = "Created" })
            @Html.HiddenFor(x => x.CreatedBy, new { @class = "CreatedBy" })
            @using (Html.DevExtreme().ValidationGroup())
            {
                <div class="row">
                    <div asp-validation-summary="ModelOnly" class="text-danger"></div>

                    <div class="col-md-12">
                        <div class="form-group">
                            <div class="dx-field">
                                <div class="dx-field-item-label-location-top">@Html.LabelFor(x => x.ProjectName)</div>
                                <div class="dx-field-item-content-location-bottom">
                                    @(Html.DevExtreme().TextBoxFor(x => x.ProjectName)
                                        .ID("projectName")
                                        .Placeholder("Escriba el nombre del proyecto")
                                        )
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-2">
                        <div class="form-group">
                            <div class="dx-field">
                                <div class="dx-field-item-label-location-top">@Html.LabelFor(x => x.CountryID)</div>
                                <div class="dx-field-item-content-location-bottom">
                                    @(Html.DevExtreme().SelectBoxFor(x => x.CountryID)
                                        .DisplayExpr("CountryNameAndAbbreviation")
                                        .ValueExpr("CountryID")
                                        .ID("countryID")
                                        .DataSource(d => d.Mvc().Controller("APICountries").LoadAction("GetSelectBox").Key("CountryID"))
                                        .SearchMode(DropDownSearchMode.Contains)
                                        .SearchEnabled(true)
                                        .MinSearchLength(3)
                                        .ShowDataBeforeSearch(true)
                                        .ShowDropDownButton(true)
                                        .DeferRendering(false)
                                        .Placeholder("Seleccione un pais...")
                                        )
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-3">
                        <div class="form-group">
                            <div class="dx-field">
                                <div class="dx-field-item-label-location-top">@Html.LabelFor(x => x.ClientID)</div>
                                <div class="dx-field-item-content-location-bottom">
                                    @(Html.DevExtreme().SelectBoxFor(x => x.ClientID)
                                        .DisplayExpr("ClientNameAndAbbreviation")
                                        .ValueExpr("ClientID")
                                        .ID("clientID")
                                        .DataSource(d => d.Mvc().Controller("APIClients").LoadAction("GetSelectBox").Key("ClientID"))
                                        .SearchMode(DropDownSearchMode.Contains)
                                        .SearchEnabled(true)
                                        .MinSearchLength(3)
                                        .ShowDataBeforeSearch(true)
                                        .ShowDropDownButton(true)
                                        .DeferRendering(false)
                                        .Placeholder("Seleccione un cliente...")
                                        )
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-7">
                        <div class="form-group">
                            <div class="dx-field">
                                <div class="dx-field-item-label-location-top">@Html.LabelFor(x => x.CustomerManager)</div>
                                <div class="dx-field-item-content-location-bottom">
                                    @(Html.DevExtreme().TextBoxFor(x => x.CustomerManager)
                                        .ID("customerManager")
                                        .Placeholder("Escriba el responsable del cliente")
                                        )
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="form-group">
                            <div class="dx-field">
                                <div class="dx-field-item-label-location-top">@Html.LabelFor(x => x.LeaderID)</div>
                                <div class="dx-field-item-content-location-bottom">
                                    @(Html.DevExtreme().SelectBoxFor(x => x.LeaderID)
                                        .DisplayExpr("FirstNameAndLastNAme")
                                        .ValueExpr("UserDataID")
                                        .ID("leaderID")
                                        .DataSource(d => d.Mvc().Controller("APIUsers").LoadAction("GetUsersByRole").LoadParams(new { role = "Admin" }).Key("LeaderID"))
                                        .SearchMode(DropDownSearchMode.Contains)
                                        .SearchEnabled(true)
                                        .MinSearchLength(3)
                                        .ShowDataBeforeSearch(true)
                                        .ShowDropDownButton(true)
                                        .DeferRendering(false)
                                        .Placeholder("Seleccione un cliente...")
                                        )
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="form-group">
                            <div class="dx-field">
                                <div class="dx-field-item-label-location-top">@Html.LabelFor(x => x.ProjectManagerID)</div>
                                <div class="dx-field-item-content-location-bottom">
                                    @(Html.DevExtreme().SelectBoxFor(x => x.ProjectManagerID)
                                        .DisplayExpr("FirstNameAndLastNAme")
                                        .ValueExpr("UserDataID")
                                        .ID("projectManagerID")
                                        .DataSource(d => d.Mvc().Controller("APIUsers").LoadAction("GetUsersByRole").LoadParams(new { role = "Admin" }).Key("LeaderID"))
                                        .SearchMode(DropDownSearchMode.Contains)
                                        .SearchEnabled(true)
                                        .MinSearchLength(3)
                                        .ShowDataBeforeSearch(true)
                                        .ShowDropDownButton(true)
                                        .DeferRendering(false)
                                        .Placeholder("Seleccione un cliente...")
                                        )
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="form-group">
                            <div class="dx-field">
                                <div class="dx-field-item-label-location-top">@Html.LabelFor(x => x.ProjectStatusID)</div>
                                <div class="dx-field-item-content-location-bottom">
                                    @(Html.DevExtreme().SelectBoxFor(x => x.ProjectStatusID)
                                        .DisplayExpr("ProjectStatusNameAndAbbreviation")
                                        .ValueExpr("ProjectStatusID")
                                        .ID("projectStatusID")
                                        .DataSource(d => d.Mvc().Controller("APIProjectStatus").LoadAction("GetSelectBox").Key("ProjectStatusID"))
                                        .SearchMode(DropDownSearchMode.Contains)
                                        .SearchEnabled(true)
                                        .MinSearchLength(3)
                                        .ShowDataBeforeSearch(true)
                                        .ShowDropDownButton(true)
                                        .DeferRendering(false)
                                        .Placeholder("Seleccione un estado del proyecto...")
                                        )
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="form-group">
                            <div class="dx-field">
                                <div class="dx-field-item-label-location-top">@Html.LabelFor(x => x.ProjectTypeID)</div>
                                <div class="dx-field-item-content-location-bottom">
                                    @(Html.DevExtreme().SelectBoxFor(x => x.ProjectTypeID)
                                        .DisplayExpr("ProjectTypeName")
                                        .ValueExpr("ProjectTypeID")
                                        .ID("projectTypeID")
                                        .DataSource(d => d.Mvc().Controller("APIProjectTypes").LoadAction("GetSelectBox").Key("ProjectTypeID"))
                                        .SearchMode(DropDownSearchMode.Contains)
                                        .SearchEnabled(true)
                                        .MinSearchLength(3)
                                        .ShowDataBeforeSearch(true)
                                        .ShowDropDownButton(true)
                                        .DeferRendering(false)
                                        .Placeholder("Seleccione un tipo de proyecto...")
                                        )
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="form-group">
                            <div class="dx-field">
                                <div class="dx-field-item-label-location-top">@Html.LabelFor(x => x.SupportStatusID)</div>
                                <div class="dx-field-item-content-location-bottom">
                                    @(Html.DevExtreme().SelectBoxFor(x => x.SupportStatusID)
                                        .DisplayExpr("SupportStatusName")
                                        .ValueExpr("SupportStatusID")
                                        .ID("supportStatusID")
                                        .DataSource(d => d.Mvc().Controller("APISupportStatus").LoadAction("GetSelectBox").Key("SupportStatusID"))
                                        .SearchMode(DropDownSearchMode.Contains)
                                        .SearchEnabled(true)
                                        .MinSearchLength(3)
                                        .ShowDataBeforeSearch(true)
                                        .ShowDropDownButton(true)
                                        .DeferRendering(false)
                                        .Placeholder("Seleccione un tipo de proyecto...")
                                        )
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="form-group">
                            <div class="dx-field">
                                <div class="dx-field-item-label-location-top">@Html.LabelFor(x => x.EstimateRequestDate)</div>
                                <div class="dx-field-item-content-location-bottom">
                                    @(Html.DevExtreme().DateBoxFor(x => x.EstimateRequestDate)
                                        .InputAttr("aria-label", "Date")
                                        .Type(DateBoxType.Date)
                                        .Value(DateTime.Now)
                                        .Placeholder("Seleccione la fecha de solicitud de estimacion ...")
                                        )
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="form-group">
                            <div class="dx-field">
                                <div class="dx-field-item-label-location-top">@Html.LabelFor(x => x.AnswerDate)</div>
                                <div class="dx-field-item-content-location-bottom">
                                    @(Html.DevExtreme().DateBoxFor(x => x.AnswerDate)
                                        .InputAttr("aria-label", "Date")
                                        .Type(DateBoxType.Date)
                                        .Value(DateTime.Now)
                                        .Placeholder("Seleccione la fecha de respuesta ...")
                                        )
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="form-group">
                            <div class="dx-field">
                                <div class="dx-field-item-label-location-top">@Html.LabelFor(x => x.RequestPriority)</div>
                                <div class="dx-field-item-content-location-bottom">
                                    @(Html.DevExtreme().TextBoxFor(x => x.RequestPriority)
                                        .ID("requestPriority")
                                        .Placeholder("Escriba la prioridad de la solicitud")
                                        )
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="form-group">
                            <div class="dx-field">
                                <div class="dx-field-item-label-location-top">@Html.LabelFor(x => x.ScalerCode)</div>
                                <div class="dx-field-item-content-location-bottom">
                                    @(Html.DevExtreme().TextBoxFor(x => x.ScalerCode)
                                        .ID("scalerCode")
                                        .Placeholder("Escriba el codigo baremador")
                                        )
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="form-group">
                            <div class="dx-field">
                                <div class="dx-field-item-label-location-top">@Html.LabelFor(x => x.ClarityCode)</div>
                                <div class="dx-field-item-content-location-bottom">
                                    @(Html.DevExtreme().TextBoxFor(x => x.ClarityCode)
                                        .ID("clarityCode")
                                        .Placeholder("Escriba el codigo de clarity")
                                        )
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="form-group">
                            <div class="dx-field">
                                <div class="dx-field-item-label-location-top">@Html.LabelFor(x => x.EstimatedHours)</div>
                                <div class="dx-field-item-content-location-bottom">
                                    @(Html.DevExtreme().NumberBoxFor(x => x.EstimatedHours)
                                        .ID("estimatedHours")
                                        .Placeholder("Escriba las horas estimadas")
                                        .InputAttr("aria-label", "Currency Format")
                                        )
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="form-group">
                            <div class="dx-field">
                                <div class="dx-field-item-label-location-top">@Html.LabelFor(x => x.StartDate)</div>
                                <div class="dx-field-item-content-location-bottom">
                                    @(Html.DevExtreme().DateBoxFor(x => x.StartDate)
                                        .InputAttr("aria-label", "Date")
                                        .Type(DateBoxType.Date)
                                        .Value(DateTime.Now)
                                        .Placeholder("Seleccione la fecha de inicio ...")
                                        )
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="form-group">
                            <div class="dx-field">
                                <div class="dx-field-item-label-location-top">@Html.LabelFor(x => x.EstimatedDeliveryDate)</div>
                                <div class="dx-field-item-content-location-bottom">
                                    @(Html.DevExtreme().DateBoxFor(x => x.EstimatedDeliveryDate)
                                        .InputAttr("aria-label", "Date")
                                        .Type(DateBoxType.Date)
                                        .Value(DateTime.Now)
                                        .Placeholder("Seleccione la fecha de entrega estimada ...")
                                        )
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="form-group">
                            <div class="dx-field">
                                <div class="dx-field-item-label-location-top">@Html.LabelFor(x => x.ActualCompletionDate)</div>
                                <div class="dx-field-item-content-location-bottom">
                                    @(Html.DevExtreme().DateBoxFor(x => x.ActualCompletionDate)
                                        .InputAttr("aria-label", "Date")
                                        .Type(DateBoxType.Date)
                                        .Value(DateTime.Now)
                                        .Placeholder("Seleccione la fecha real de finalizacion ...")
                                        )
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-2">
                        <div class="form-group">
                            <div class="dx-field">
                                <div class="dx-field-item-label-location-top">@Html.LabelFor(x => x.CurrencyID)</div>
                                <div class="dx-field-item-content-location-bottom">
                                    @(Html.DevExtreme().SelectBoxFor(x => x.CurrencyID)
                                        .DisplayExpr("CurrencyNameAndAbbreviation")
                                        .ValueExpr("CurrencyID")
                                        .ID("currencyID")
                                        .DataSource(d => d.Mvc().Controller("APICurrencies").LoadAction("GetSelectBox").Key("CurrencyID"))
                                        .SearchMode(DropDownSearchMode.Contains)
                                        .SearchEnabled(true)
                                        .MinSearchLength(3)
                                        .ShowDataBeforeSearch(true)
                                        .ShowDropDownButton(true)
                                        .DeferRendering(false)
                                        .Placeholder("Seleccione una moneda...")
                                        )
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-2">
                        <div class="form-group">
                            <div class="dx-field">
                                <div class="dx-field-item-label-location-top">@Html.LabelFor(x => x.ProjectValue)</div>
                                <div class="dx-field-item-content-location-bottom">
                                    @(Html.DevExtreme().NumberBoxFor(x => x.ProjectValue)
                                        .ID("projectValue")
                                        .Placeholder("Escriba el valor del proyecto")
                                        .Format("$ #,##0.##")
                                        .InputAttr("aria-label", "Currency Format")
                                        )
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-2">
                        <div class="form-group">
                            <div class="dx-field">
                                <div class="dx-field-item-label-location-top">@Html.LabelFor(x => x.ProjectCost)</div>
                                <div class="dx-field-item-content-location-bottom">
                                    @(Html.DevExtreme().NumberBoxFor(x => x.ProjectCost)
                                        .ID("projectCost")
                                        .Placeholder("Escriba el costo del proyecto")
                                        .Format("$ #,##0.##")
                                        .InputAttr("aria-label", "Currency Format")
                                        )
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-2">
                        <div class="form-group">
                            <div class="dx-field">
                                <div class="dx-field-item-label-location-top">@Html.LabelFor(x => x.TRMProject)</div>
                                <div class="dx-field-item-content-location-bottom">
                                    @(Html.DevExtreme().NumberBoxFor(x => x.TRMProject)
                                        .ID("tRMProject")
                                        .Placeholder("Escriba la TRM del proyecto")
                                        .Format("$ #,##0.##")
                                        .InputAttr("aria-label", "Currency Format")
                                        )
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-2">
                        <div class="form-group">
                            <div class="dx-field">
                                <div class="dx-field-item-label-location-top">@Html.LabelFor(x => x.GrossMargin)</div>
                                <div class="dx-field-item-content-location-bottom">
                                    @(Html.DevExtreme().NumberBoxFor(x => x.GrossMargin)
                                        .ID("grossMargin")
                                        .Disabled(true)
                                        .Format("$ #,##0.##")
                                        .InputAttr("aria-label", "Currency Format")
                                        )
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-2">
                        <div class="form-group">
                            <div class="dx-field">
                                <div class="dx-field-item-label-location-top">@Html.LabelFor(x => x.Billable)</div>
                                <div class="dx-field-item-content-location-bottom">
                                    @(Html.DevExtreme().CheckBoxFor(x => x.Billable)
                                        .ID("billable")
                                        .Value(true)
                                        .ElementAttr("aria-label", "Checked")
                                        )
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-12">
                        <div class="form-group">
                            <div class="dx-field">
                                <div class="dx-field-item-label-location-top">@Html.LabelFor(x => x.Justification)</div>
                                <div class="dx-field-item-content-location-bottom">
                                    @(Html.DevExtreme().TextAreaFor(x => x.Justification)
                                        .ID("justification")
                                        .Placeholder("Escriba la justificacion")
                                        .AutoResizeEnabled(true)
                                        )
                                </div>
                            </div>
                        </div>
                    </div>

                    <br />

                    <div class="col-md-12">
                        <div class="form-group">
                            <a class="btn btn-outline-secondary p-1" onclick="redirectToEdit()">
                                <img src="~/img/edit.png" style="width:24px" title="Editar" />
                            </a>
                            <a class="btn btn-outline-secondary p-1">
                                <img src="~/img/schedule.png" style="width:24px" title="Programaci�n" />
                            </a>
                            <a class="btn btn-outline-secondary p-1" onclick="redirectToMilestone()">
                                <img src="~/img/hito.png" style="width:24px" title="Hitos" />
                            </a>
                            <a class="btn btn-outline-secondary p-1" onclick="redirectToResourcePlanning()">
                                <img src="~/img/recursos.png" style="width:24px" title="Uso Recursos" />
                            </a>
                            <a class="btn btn-outline-secondary p-1" onclick="redirectToTask()">
                                <img src="~/img/task.png" style="width:24px" title="Listado de Tareas" />
                            </a>
                            <a class="btn btn-outline-secondary p-1" onclick="redirectToCommitment()">
                                <img src="~/img/compromise.png" style="width:24px" title="Compromisos" />
                            </a>
                            <a class='btn btn-outline-secondary p-1' onclick="confirmDelete()">
                                <img src="~/img/trash.png" style="width:24px" title="Eliminar" />
                            </a>
                        </div>
                    </div>

                    <br />

                    <div class="col-md-12 p-4">
                        <div class="form-group">
                            <div class="center">
                                @(Html.DevExtreme().Button()
                                    .ElementAttr("class", "validate")
                                    .Text("Guardar")
                                    .Type(ButtonType.Success)
                                    .UseSubmitBehavior(true)
                                    .OnClick("saveClick")
                                    )
                            </div>
                        </div>
                    </div>

                    <br />
                    <br />

                </div>
            }
        </form>
    </div>

</div>

<script>
    DevExpress.config({
        editorStylingMode: "filled"
    });

    function saveClick(e) {
        var result = e.validationGroup.validate();
        if (!result.isValid) {
            DevExpress.ui.notify("Debe diligenciar todos los campos obligatorios.", "error");
            e.cancel;
        }
    }

    function redirectToEdit() {
        var projectId = document.getElementsByClassName("ProjectID")[0].value; // Obtén el valor del ProjectID desde el elemento HiddenFor
        var url = '/project/edit/' + projectId; // Construye la URL con el ProjectID
        window.location.href = url; // Redirecciona a la vista project/edit con el ProjectID en la URL
    }

    function redirectToMilestone() {
        var projectId = document.getElementsByClassName("ProjectID")[0].value; // Obtén el valor del ProjectID desde el elemento HiddenFor
        var url = '/project/milestone/' + projectId; // Construye la URL con el ProjectID
        window.location.href = url; // Redirecciona a la vista project/edit con el ProjectID en la URL
    }

    function redirectToResourcePlanning() {
        var projectId = document.getElementsByClassName("ProjectID")[0].value; // Obtén el valor del ProjectID desde el elemento HiddenFor
        var url = '/project/resourceplanning/' + projectId; // Construye la URL con el ProjectID
        window.location.href = url; // Redirecciona a la vista project/edit con el ProjectID en la URL
    }

    function redirectToTask() {
        var projectId = document.getElementsByClassName("ProjectID")[0].value; // Obtén el valor del ProjectID desde el elemento HiddenFor
        var url = '/project/task/' + projectId; // Construye la URL con el ProjectID
        window.location.href = url; // Redirecciona a la vista project/edit con el ProjectID en la URL
    }

    function redirectToCommitment() {
        var projectId = document.getElementsByClassName("ProjectID")[0].value; // Obtén el valor del ProjectID desde el elemento HiddenFor
        var url = '/project/Commitment/' + projectId; // Construye la URL con el ProjectID
        window.location.href = url; // Redirecciona a la vista project/edit con el ProjectID en la URL
    }

    function confirmDelete() {
        var projectId = document.getElementsByClassName("ProjectID")[0].value; // Obtén el valor del ProjectID desde el elemento HiddenFor

        DevExpress.ui.dialog.confirm("¿Estás seguro de que deseas eliminar este proyecto?", "Confirmar eliminación").done(function (dialogResult) {
            if (dialogResult) {
                // Si el usuario selecciona "Aceptar", redirecciona a la vista project/delete con el ProjectID en la URL
                var url = '/project/delete/' + projectId;
                window.location.href = url;
            } else {
                // Si el usuario selecciona "Cancelar", no se hace nada
            }
        });
    }
</script>